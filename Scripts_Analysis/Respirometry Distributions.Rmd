---
title: "Respirometry Distributions"
editor_options: null
chunk_output_type: inline
output: html_document
df_print: paged
---
### Goal: Rear UZ and BE at 23C at 16:8 and 12:12 L:D regimens (UZ12, UZ16, BE12, BE16). Track CO2 production as a function of number of days after molting into the 5th instar. Track average weight gain as a function of number of days after molting into the 5th instar. Compare CO2 production and weight gain within strain and between L:D then compare L:D between strains 

##Call Data
````{r}
library(splines)
library(stats)
library(readxl)
library(ggplot2)
library(nlme)
library(lme4)
library(lmerTest)
library(ez)
library(lsr)
library(dplyr)
library(tidyr)
library(MASS)
library(doBy)
library(plyr)

#############--------------Read in the data-----------------######################
#PC
setwd("/Users/jbrown/Documents/GitHub/Respirometry/Data")
data=read_excel("Respir.xlsx")


#MAC
#data=read_excel("/Users/JamesB/Google Drive/Graduate School/Self_JamesTBrown/GitHub/Respirometry/Data/Respir.xlsx", sheet = "Sheet1")

############## Data Prep ###################
data=subset(data, VCO2!="NA") # Remove NAs from df
data=subset(data, syringe!="Blank Control") #Removing "Blank Control" syringes
data$syringe=as.character(data$syringe) #Set "syringe" as a character
data$strain<-as.factor(data$strain) #set strain as ind var
data$treat<-as.factor(data$treat) #set treat as factor as ind var
````
##Dataframe Setup
````{r}
##########################################
#df BE Rep1 Stages Plots and Data Analysis
##########################################
dataBEr1s=data #subset of main df into BE rep1
dataBEr1s=subset(dataBEr1s, treat=="1" | treat=="2")
dataBEr1s=subset(dataBEr1s, Tray=="12,23 1201-01"|Tray=="12,23 1201-02"|Tray=="16,23 1202"|Tray=="16,23 1201")

##########################################
#df BE Rep2 Stages Plots and Data Analysis
##########################################
dataBEr2s=data #subset of main df into BE rep 2
dataBEr2s=subset(dataBEr2s, treat=="1" | treat=="2")
dataBEr2s=subset(dataBEr2s, Tray=="16,23 0208" | Tray=="12,23 0208")

##########################################
#df UZ Rep1 Stages Plots and Data Analysis
##########################################
dataUZr1s=data #subset of main df into UZ rep 1
dataUZr1s=subset(dataUZr1s, treat=="1" | treat=="2")
dataUZr1s=subset(dataUZr1s, Tray=="16,23 1228" | Tray=="12,23 1228")
`````
## Treatment comparison of chainges in CO2, CO2 weighted by mass, mass, and stage
```{r}
#Larva CO2: Change over time
dataBEUZ=subset(data, stage=="L")
dataBEUZ=subset(dataBEUZ,Tray!="12,23 1201-01"|Tray=="12,23 1201-02"|Tray=="16,23 1202"|Tray=="16,23 1201")
dataBEUZ=subset(dataBEUZ, treat=="1"|treat=="2")
ggplot(data=dataBEUZ,aes(x=day,y=co2_hourly))+
  geom_smooth()+
  facet_grid(treat~strain)+
  geom_point()+
  theme_classic()+
  ggtitle("Change in CO2 Production")+
  ylab("CO2")+xlab("Day")

ggplot(data=dataBEUZ,aes(x=day,y=co2_hourly))+
  geom_smooth()+
  facet_wrap(~treat)+
  geom_point()+
  theme_classic()+
  ggtitle("Change in CO2 Production")+
  ylab("CO2")+xlab("Day")

modco2=lmer(co2_hourly~treat + (1|day),data=dataBEUZ)
summary(modco2)

#Larva CO2 by Mass: Change over time
dataBEUZcm=subset(data, stage=="L")
dataBEUZcm=subset(dataBEUZcm,Tray!="12,23 1201-01"|Tray=="12,23 1201-02"|Tray=="16,23 1202"|Tray=="16,23 1201")
dataBEUZcm=subset(dataBEUZcm,day<=9)
dataBEUZcm=subset(dataBEUZcm, treat=="1"|treat=="2")
ggplot(data=dataBEUZcm,aes(x=day,y=co2_hourly_mass, color=strain,group=strain))+
  stat_summary(fun.y=mean, geom="line")+
  facet_grid(strain~treat)+
  stat_summary(fun.data=mean_se, geom="errorbar", width=0.05) +
  theme_classic()+
  ggtitle("Change in CO2 Production Weighted by Mass")+
  ylab("CO2 x Mass")+xlab("Day")

ggplot(data=dataBEUZcm,aes(x=day,y=co2_hourly_mass))+
  geom_smooth()+
  facet_wrap(~treat)+
  geom_point()+
  theme_classic()+
  ggtitle("Change in CO2 Production Weighted by Mass")+
  ylab("CO2 x Mass")+xlab("Day")

dataBE=subset(dataBEUZcm,strain=="BE")
#dataBE=subset(dataBe,day<=10)
modco2m=lmer(co2_hourly_mass~treat + (1|day),data=dataBE)
summary(modco2m)

dataUZ=subset(dataBEUZcm,strain=="UZ")
#dataUZ=subset(dataUZ,day<=10)
modco2m=lmer(co2_hourly_mass~treat + (1|day),data=dataUZ)
summary(modco2m)

dataDia=subset(dataBEUZcm,treat=="1")
#dataBE=subset(dataBe,day<=10)
modco2md=lmer(co2_hourly_mass~strain + (1|day),data=dataDia)
summary(modco2md)

dataNDia=subset(dataBEUZcm,treat=="2")
#dataUZ=subset(dataUZ,day<=10)
modco2mnd=lmer(co2_hourly_mass~strain + (1|day),data=dataNDia)
summary(modco2mnd)


#Larva MASS: Change Over Time
dataBEUZm=data
dataBEUZm=subset(dataBEUZm, stage=="L")
dataBEUZm=subset(dataBEUZm,Tray!="12,23 1201-01"|Tray=="12,23 1201-02"|Tray=="16,23 1202"|Tray=="16,23 1201")
dataBEUZm=subset(dataBEUZm, treat=="1"|treat=="2")
ggplot(data=dataBEUZm,aes(x=day,y=mass))+
  geom_line(aes(group=syringe,color=syringe))+
  facet_grid(treat~strain)+
  geom_smooth()+
  theme_classic()+
  ggtitle("Larvae Mass Increase")+
  ylab("Mass")+xlab("Day")

###
dataBEUZm=subset(data, stage=="L")
dataBEUZm=subset(dataBEUZm,Tray!="12,23 1201-01"|Tray=="12,23 1201-02"|Tray=="16,23 1202"|Tray=="16,23 1201")
dataBEUZm=subset(dataBEUZm,day<=9)
dataBEUZm=subset(dataBEUZm, treat=="1"|treat=="2")
ggplot(data=dataBEUZm,aes(x=day,y=mass, color=strain,group=strain))+
  stat_summary(fun.y=mean, geom="line")+
  facet_grid(strain~treat)+
  stat_summary(fun.data=mean_se, geom="errorbar", width=0.05) +
  theme_classic()+
  ggtitle("Change in  Mass")+
  ylab("CO2 x Mass")+xlab("Day")

ggplot(data=dataBEUZm,aes(x=day,y=mass))+
  geom_smooth()+
  facet_wrap(~treat)+
  geom_point()+
  theme_classic()+
  ggtitle("Change in  Mass")+
  ylab("CO2 x Mass")+xlab("Day")

dataBE=subset(dataBEUZm,strain=="BE")
#dataBE=subset(dataBe,day<=10)
modco2m=lmer(mass~treat + (1|day),data=dataBE)
summary(modco2m)

dataUZ=subset(dataBEUZm,strain=="UZ")
#dataUZ=subset(dataUZ,day<=10)
modco2m=lmer(mass~treat + (1|day),data=dataUZ)
summary(modco2m)

dataDia=subset(dataBEUZm,treat=="1")
#dataBE=subset(dataBe,day<=10)
modco2md=lmer(mass~strain + (1|day),data=dataDia)
summary(modco2md)

dataNDia=subset(dataBEUZm,treat=="2")
#dataUZ=subset(dataUZ,day<=10)
modco2mnd=lmer(mass~strain + (1|day),data=dataNDia)
summary(modco2mnd)
###


ggplot(dataBEUZm, aes(x=day,color=mass))+
  geom_histogram(aes(fill=treat),alpha=.3)+
  facet_grid(treat~strain, scales ="free_y")+
  scale_x_continuous(breaks=pretty(dataBEUZm$day, n=25))+ 
  ggtitle("Mass")

ggplot(dataBEUZm, aes(x=day,color=mass))+
  geom_density(aes(fill=treat),alpha=.3)+
  facet_wrap(~treat)+
  scale_x_continuous(breaks=pretty(dataBEUZm$day, n=25))+ 
  ggtitle("Mass")
```
## BE Rep 1
```{r}
##BE Rep 1##
dataBEUZp=data
dataBEUZp=subset(dataBEUZp,stage=="L"|stage=="P")
dataBEUZp=subset(dataBEUZp, treat=="1"|treat=="2")
#dataBEr1p=subset(dataBEr1p, treat=="2")
dataBEr1p=subset(dataBEUZp, day<=30)
#Stages: Change Over Time

ggplot(dataBEUZp, aes(x=day, fill=stage))+
  theme_classic()+
  geom_histogram(binwidth=.5, alpha=.5, position="identity")+
  scale_x_discrete(limits=c(1,2,3,4,5,6,7,8,9,10,11,13,15,17))+
  ggtitle("Stages")+
  ylab("# of Insects in each stage")+xlab("Day")


ggplot(dataBEUZp, aes(x=day, fill=stage))+
  geom_density(alpha=.3)+   
  facet_grid(treat~strain, scales ="free_y")+
  ggtitle("Stages")

ggplot(dataBEUZp, aes(x=day, fill=stage))+
  geom_density(alpha=.3)+
  facet_wrap(~treat)
  ggtitle("Stages")
```

##BE Rep 1: Changes in CO2, CO2 Weighted by Mass, Mass, and Stage, across time
```{r} 
##################
#### BE REP 1 ####
##################

#Larva CO2: Change over time
dataBEr1co2=subset(dataBEr1s, stage=="L")
ggplot(data=dataBEr1co2,aes(x=day,y=co2_hourly))+
  geom_smooth()+
  facet_grid(treat~start, scales ="free_y")+
  geom_point()+
  theme_classic()+
  ggtitle("BE Rep1 Change in CO2 Production")+
  ylab("CO2")+xlab("Day")

#Larva CO2 by Mass: Change over time
dataBEr1co2m=subset(dataBEr1s, stage=="L")
ggplot(data=dataBEr1co2m,aes(x=day,y=co2_hourly_mass))+
  geom_smooth()+
  facet_grid(treat~start, scales ="free_y")+
  geom_point()+
  theme_classic()+
  ggtitle("BE Rep1 Change in CO2 Production Weighted by Mass")+
  ylab("CO2 x Mass")+xlab("Day")

#Larva MASS: Change Over Time
dataBEr1m=dataBEr1s
dataBEr1m=subset(dataBEr1m, stage=="L")
ggplot(data=dataBEr1m,aes(x=day,y=mass))+
  geom_line(aes(group=syringe,color=syringe))+
  facet_grid(treat~start, scales ="free_y")+
  geom_smooth()+
  theme_classic()+
  ggtitle("BE Rep1 Larvae Mass Increase")+
  ylab("Mass")+xlab("Day")

ggplot(dataBEr1m, aes(x=day,color=mass))+
  geom_density(aes(fill=treat),alpha=.3)+
  facet_grid(treat~start, scales ="free_y")+
  scale_x_continuous(breaks=pretty(dataBEr1m$day, n=25))+ 
  ggtitle("BE Rep1 Mass")

##BE Rep 1##
dataBEr1p=subset(dataBEr1s,stage=="L"|stage=="P")
#dataBEr1p=subset(dataBEr1p, treat=="2")
dataBEr1p=subset(dataBEr1p, day<=30)
#Stages: Change Over Time

ggplot(dataBEr1p, aes(x=day, fill=stage))+
  theme_classic()+
  geom_histogram(binwidth=.5, alpha=.5, position="identity")+
  scale_x_discrete(limits=c(1,2,3,4,5,6,7,8,9,10,11,13,15,17))+
  ggtitle("BE Rep1 Stages")+
  ylab("# of Insects in each stage")+xlab("Day")

ggplot(dataBEr1p, aes(x=day, fill=stage))+
  geom_density(alpha=.3)+   
  facet_grid(treat~start, scales ="free_y")+
  ggtitle("BE Rep1 Stages")
```

##BE Rep1 Stats
```{r}
##############################################
###### BE Rep 1 Peak Mass Comaprison #########
##############################################

#fit first degree polynomial equation:
fit  <- lm(mass~day, data = dataBEr1m)
summary(fit)
coef(fit)

#second degree
fit2 <- lm(mass~poly(day,2,raw=TRUE), data = dataBEr1m)
summary(fit2)
coef(fit2)

#third degree
fit3 <- lm(mass~poly(day,3,raw=TRUE), data = dataBEr1m)
summary(fit3)
coef(fit3)

#fourth degree
fit4 <- lm(mass~poly(day,4,raw=TRUE), data = dataBEr1m)
summary(fit4)
coef(fit4)

anova(fit,fit2) #fit2
anova(fit,fit3) #fit3
anova(fit,fit4) #fit4 
anova(fit2,fit3) #fit3
anova(fit2,fit4) #fit4
anova(fit3,fit4) #fit4
```
##BE Rep 2: Changes in CO2, CO2 Weighted by Mass, Mass, and Stage, across time
```{r}
##################
#### BE REP 2 ####
##################

#Larva CO2: Change over time
dataBEr2co2=subset(dataBEr2s, stage=="L")
ggplot(data=dataBEr2co2,aes(x=day,y=co2_hourly))+
  geom_smooth()+
  facet_grid(treat~start, scales ="free_y")+
  geom_point()+
  theme_classic()+
  ggtitle("BE Rep2 Change in CO2 Production")+
  ylab("CO2")+xlab("Day")


#Larva CO2 by Mass: Change over time
dataBEr2co2m=subset(dataBEr2s, stage=="L")
ggplot(data=dataBEr2co2m,aes(x=day,y=co2_hourly_mass))+
  geom_smooth()+
  facet_grid(treat~start, scales ="free_y")+
  geom_point()+
  theme_classic()+
  ggtitle("BE Rep2 Change in CO2 Production Weighted by Mass")+
  ylab("CO2 x Mass")+xlab("Day")


#Larva MASS: Change Over Time
dataBEr2m=dataBEr2s
dataBEr2m=subset(dataBEr2m, stage=="L")
ggplot(data=dataBEr2m,aes(x=day,y=mass))+
  geom_line(aes(group=syringe,color=syringe))+
  facet_grid(treat~start, scales ="free_y")+
  geom_smooth()+
  theme_classic()+
  ggtitle("BE Rep2 Larvae Mass Increase")+
  ylab("Mass")+xlab("Day")

ggplot(dataBEr2m, aes(x=day,color=mass))+
  geom_density(aes(fill=treat),alpha=.3)+
  facet_grid(treat~start, scales ="free_y")+
  scale_x_continuous(breaks=pretty(dataBEr2m$day, n=25))+ 
  ggtitle("BE Non Diapause Rep1 Stages")

##BE Rep 2##
dataBEr2p=subset(dataBEr2s,stage=="L"|stage=="P")
#dataBEr2p=subset(dataBEr2p, treat=="2")
dataBEr2p=subset(dataBEr2p, day<=20)
#Stages: Change Over Time

ggplot(dataBEr2p, aes(x=day, fill=stage))+
  geom_density(alpha=.3)+
  facet_grid(treat~start, scales ="free_y")+
  ggtitle("BE Non Diapause Rep2 Stages")


ggplot(dataBEr2p, aes(x=day, fill=stage))+
  theme_classic()+
  geom_histogram(binwidth=.5, alpha=.5, position="identity")+
  scale_x_discrete(limits=c(1,2,3,4,5,6,7,8,9,10,11,13,15,17))+
  ggtitle("BE Non Diapause Rep2 Stages")+
  ylab("# of Insects in each stage")+xlab("Day")
```
##UZ Rep 1: Changes in CO2, CO2 Weighted by Mass, Mass, and Stage, across time
```{r}
##################
#### UZ REP 1 ####
##################

#Larva CO2: Change over time
dataUZr1co2=subset(dataUZr1s, stage=="L")
ggplot(data=dataUZr1co2,aes(x=day,y=co2_hourly))+
  geom_smooth()+
  facet_grid(treat~start, scales ="free_y")+
  geom_point()+
  theme_classic()+
  ggtitle("UZ Rep1 Change in CO2 Production")+
  ylab("CO2")+xlab("Day")


#Larva CO2 by Mass: Change over time
dataUZr1co2m=subset(dataUZr1s, stage=="L")
ggplot(data=dataUZr1co2m,aes(x=day,y=co2_hourly_mass))+
  geom_smooth()+
  facet_grid(treat~start)+
  geom_point()+
  theme_classic()+
  ggtitle("UZ Rep1 Change in CO2 Production Weighted by Mass")+
  ylab("CO2 x Mass")+xlab("Day")


#Larva MASS: Change Over Time
dataUZr1m=dataUZr1s
dataUZr1m=subset(dataUZr1m, stage=="L")
ggplot(data=dataUZr1m,aes(x=day,y=mass))+
  geom_line(aes(group=syringe,color=syringe))+
  facet_grid(treat~start, scales ="free_y")+
  geom_smooth()+
  theme_classic()+
  ggtitle("UZ Rep1 Larvae Mass Increase")+
  ylab("Mass")+xlab("Day")

ggplot(dataUZr1m, aes(x=day,color=mass))+
  geom_density(aes(fill=treat),alpha=.3)+
  facet_grid(treat~start, scales ="free_y")+
  scale_x_continuous(breaks=pretty(dataUZr1m$day, n=25))+ 
  ggtitle("UZ Rep1 Stages")



##UZ Rep 1##
dataUZr1p=subset(dataUZr1s,stage=="L"|stage=="P")
#dataUZr1p=subset(dataUZr1p, treat=="2")
dataUZr1p=subset(dataUZr1p, day<=20)
#Stages: Change Over Time

ggplot(dataUZr1p, aes(x=day, fill=stage))+
  geom_density(alpha=.3)+
  facet_grid(treat~start, scales ="free_y")+
  ggtitle("UZ Rep1 Stages")

ggplot(dataUZr1p, aes(x=day, fill=stage))+
  theme_classic()+
  geom_histogram(binwidth=.5, alpha=.5, position="identity")+
  scale_x_discrete(limits=c(1,2,3,4,5,6,7,8,9,10,11,13,15,17))+
  ggtitle("UZ Non Diapause Rep1 Stages")+
  ylab("# of Insects in each stage")+xlab("Day")
```


##CO2 Production Over Time
````{}
##Point Plot: Hourly CO2 production
dataCO2=data
dataCO2=subset(dataCO2,treat=="1"|treat=="2")
dataCO2=subset(dataCO2,day<=12)
dataCO2=subset(dataCO2,stage=="L")
dataCO2=subset(dataCO2,Tray!="12,23 1201-02"&Tray!="12,23 1201-01"&Tray!="16,23 1202"&Tray!="16,23 1201")
ggplot(data=dataCO2,aes(x=day,y=co2_hourly, color=treat))+
  facet_wrap(~strain)+
  geom_point()+
  geom_smooth(method="loess")+
  theme_classic()+
  scale_colour_discrete(name="Treatment",breaks=c("1", "2"),labels=c("Diapause", "Non-Diapause"))+
  ggtitle("Larvae CO2 production")+
  ylab("CO2 production")

##Point Plot: Hourly CO2 production
dataCO2=data
dataCO2=subset(dataCO2,treat=="3"|treat=="4")
dataCO2=subset(dataCO2,stage=="L")
ggplot(data=dataCO2,aes(x=day,y=co2_hourly, color=treat))+facet_wrap(~strain)+
  geom_point()+
  geom_smooth(method="loess")+
  theme_classic()+
  scale_colour_discrete(name="Treatment",breaks=c("3", "4"),labels=c("Diapause", "post45:Non-Diapause"))+
  ggtitle("Larvae CO2 production")+
  ylab("CO2 production")

##Point Plot: Hourly CO2 production by mass
dataCO2m=data
dataCO2m=subset(dataCO2m,treat=="1"|treat=="2")
dataCO2m=subset(dataCO2m,day<=12)
dataCO2m=subset(dataCO2m,stage=="L")
dataCO2m=subset(dataCO2m,Tray!="12,23 1201-02"&Tray!="12,23 1201-01"&Tray!="16,23 1202"&Tray!="16,23 1201")
ggplot(data=dataCO2m,aes(x=day,y=co2_hourly_mass, color=treat))+
  facet_wrap(~strain)+
  geom_point()+
  geom_smooth(method="loess")+
  scale_colour_discrete(name="Treatment",breaks=c("1", "2"),labels=c("Diapause", "Non-Diapause"))+
  theme_classic()+
  ggtitle("Larvae CO2 production")+
  ylab("CO2 production by Mass")

##Point Plot: Hourly CO2 production by mass
dataCO2m=data
dataCO2m=subset(dataCO2m,treat=="3"|treat=="4")
ggplot(data=dataCO2m,aes(x=day,y=co2_hourly_mass, color=treat))+facet_wrap(~strain)+
  geom_point()+
  geom_smooth(method="loess")+
  scale_colour_discrete(name="Treatment",breaks=c("3", "4"),labels=c("Diapause", "post 45:Non-Diapause"))+
  theme_classic()+
  ggtitle("Larvae CO2 production")+
  ylab("CO2 production by Mass")
````